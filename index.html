<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUINTUS ULTRA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, get, set, child, update, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // --- Corrected Firebase Configuration ---
        // This config is now hardcoded to prevent initialization errors.
        const firebaseConfig = {
            apiKey: "AIzaSyBL-oA4C7TPHxEBrW9QwxgNE9n8-uCEhRY",
            authDomain: "webut-83a0f.firebaseapp.com",
            databaseURL: "https://webut-83a0f-default-rtdb.firebaseio.com",
            projectId: "webut-83a0f",
            storageBucket: "webut-83a0f.appspot.com",
            messagingSenderId: "11308229615",
            appId: "1:11308229615:web:741af2dcfd77874bd74c1a",
            measurementId: "G-Y37GLFE8H7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Export Firebase instances for global use in the script
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        
        // Expose specific database functions to the global scope
        window.dbRef = ref;
        window.dbGet = get;
        window.dbSet = set;
        window.dbChild = child;
        window.dbUpdate = update;
        window.dbOnValue = onValue;


        // --- System Status Check ---
        // Checks for maintenance mode or web off before doing anything else.
        const settingsRef = ref(db, 'settings');
        onValue(settingsRef, (snapshot) => {
            const settings = snapshot.val();
            if (settings) {
                if (settings.maintenanceMode) {
                    document.body.innerHTML = `<div style="text-align: center; padding: 50px; font-family: 'El Messiri', sans-serif; color: #C2185B; font-size: 24px;">Site is under maintenance. Please check back later.</div>`;
                    return;
                }
                if (settings.webOff) {
                    if (settings.redirectUrl) {
                        window.location.replace(settings.redirectUrl);
                    } else {
                        document.body.innerHTML = `<div style="text-align: center; padding: 50px; font-family: 'El Messiri', sans-serif; color: #C2185B; font-size: 24px;">404 - Not Found</div>`;
                    }
                    return;
                }
            }
            // If no blocking settings, proceed with auth.
            setupFirebaseAuth();
        }, {
            onlyOnce: true // We only need to check this once on load
        });


        // Attach the auth state listener and initial sign-in to a global function
        function setupFirebaseAuth() {
             signInAnonymously(auth)
                .then(() => {
                    console.log("Anonymous sign-in successful.");
                    // Check local storage to see if user was already logged in
                    if (localStorage.getItem('isLoggedIn') === 'true') {
                        showMainApp();
                    } else {
                        showLogin();
                    }
                })
                .catch((error) => {
                    console.error("Firebase sign-in error:", error);
                    const errorElement = document.getElementById('error');
                    if (errorElement) {
                        errorElement.innerText = "Authentication service failed. Please refresh.";
                        gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                    }
                });
        };
    </script>

    <style>
        /* All original CSS styles are preserved here */
        :root {
            --primary: #87CEEB; /* Sky Blue - a soft, pleasant blue */
            --primary-light: #ADD8E6; /* Lighter Blue - for borders, subtle elements */
            --primary-dark: #4682B4; /* Steel Blue - for titles, icons, stronger accents */
            --secondary: #FFB6C1; /* Light Pink - for gradients, complementary accents */
            --white: #FFFFFF;
            --light-bg: #FDFDFD; /* Very subtle off-white for main background */
            --text-dark: #333333;
            --text-light: #666666;
        }

        body {
            font-family: 'El Messiri', sans-serif;
            background: linear-gradient(135deg, #FCE4EC, #E0FFFF); /* Original app background */
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
            padding: 0;
            color: #C2185B; /* Original app text color */
            display: flex; /* Added for centering login */
            align-items: center; /* Added for centering login */
            justify-content: center; /* Added for centering login */
        }
        /* Override specific body styles for login page background */
        body.login-body {
            background: linear-gradient(135deg, #E0F2F7, #F8EAF0); /* Login page background */
        }


        * {
            color: inherit; 
        }
        .login-container * {
            color: var(--text-dark); 
        }
        .login-container .title {
            -webkit-text-fill-color: unset; 
        }


        .popup, .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(224, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 6px 16px rgba(70, 130, 180, 0.3);
            backdrop-filter: blur(8px);
            z-index: 1000;
            width: 90%;
            max-width: 400px;
            border: 2px solid #FFC0CB;
        }
        .popup.active, .modal.active {
            display: block;
        }
        .card {
            transition: all 0.3s ease;
            background: rgba(224, 255, 255, 0.9);
            border-radius: 1.5rem;
            box-shadow: 0 6px 12px rgba(70, 130, 180, 0.2);
            backdrop-filter: blur(8px);
            position: relative;
            margin: 0.75rem;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 0 8px 16px rgba(70, 130, 180, 0.3);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4682B4, #E91E63);
        }
        svg {
            width: 100%;
            height: auto;
            margin: 0 auto;
            display: block;
        }
        svg text {
            text-anchor: middle;
            dominant-baseline: middle;
            text-transform: uppercase;
            animation: stroke 5s infinite alternate;
            stroke-width: 1.2;
            stroke: #4682B4;
            font-size: 10vw;
            fill: rgba(224, 255, 255, 0);
        }
        @media (min-width: 768px) {
            svg text {
                font-size: 8vw;
            }
        }
        @media (min-width: 1024px) {
            svg text {
                font-size: 6vw;
            }
        }
        @keyframes stroke {
            0% { fill: rgba(224, 255, 255, 0); stroke: #4682B4; stroke-dashoffset: 25%; stroke-dasharray: 0 50%; stroke-width: 1.2; }
            70% { fill: rgba(224, 255, 255, 0); stroke: #E91E63; }
            80% { fill: rgba(224, 255, 255, 0); stroke: #FCE4EC; stroke-width: 2.5; }
            100% { fill: #FCE4EC; stroke: rgba(70, 130, 180, 0); stroke-dashoffset: -25%; stroke-dasharray: 50% 0; stroke-width: 0; }
        }
        .history-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: none;
            overflow: visible;
            position: relative;
        }
        .history-item {
            transition: all 0.3s ease;
            width: 100%;
            max-width: 100%;
            margin: 0;
            border-radius: 1.2rem;
            background: rgba(224, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 14px rgba(70, 130, 180, 0.15);
            position: relative;
            overflow: hidden;
            padding: 1.2rem;
            border-left: 4px solid transparent;
        }
        .history-item.pending { border-left-color: #FFC107; background: linear-gradient(135deg, rgba(255, 193, 7, 0.08), rgba(224, 255, 255, 0.85)); }
        .history-item.predicted { border-left-color: #4682B4; background: linear-gradient(135deg, rgba(70, 130, 180, 0.08), rgba(224, 255, 255, 0.85)); }
        .history-item:hover { transform: scale(1.02); box-shadow: 0 6px 18px rgba(70, 130, 180, 0.25); }
        .history-item.fade-out { animation: fadeOut 0.5s ease forwards; }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.95); height: 0; padding: 0; margin: 0; }
        }
        .history-item .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 1.5rem;
            color: rgba(70, 130, 180, 0.15);
            pointer-events: none;
            z-index: 0;
            text-transform: uppercase;
            font-weight: bold;
        }
        .small-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFC0CB;
            border-radius: 50%;
            animation: float 4s infinite;
            z-index: 1;
        }
        @keyframes float {
            0% { transform: translate(0, 0); opacity: 0.9; }
            50% { transform: translate(12px, -12px); opacity: 0.5; }
            100% { transform: translate(0, 0); opacity: 0.9; }
        }
        .delete-btn:hover { color: #4682B4; transform: scale(1.3); }
        .pending-badge { background: rgba(255, 193, 7, 0.15); color: #FF8F00; }
        .predicted-badge { background: rgba(70, 130, 180, 0.15); color: #4682B4; }
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }
        .status-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            opacity: 0.2;
            background: radial-gradient(circle, currentColor 0%, transparent 70%);
        }
        .pending-icon { color: #FFC107; animation: rotate 2s infinite linear; }
        .predicted-icon { color: #4682B4; animation: pulseWin 1.5s infinite; }
        @keyframes pulseWin {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(70, 130, 180, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(70, 130, 180, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(70, 130, 180, 0); }
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .dashboard-card {
            background: rgba(224, 255, 255, 0.9);
            border-radius: 1.5rem;
            padding: 1.2rem;
            box-shadow: 0 4px 10px rgba(70, 130, 180, 0.15);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 14px rgba(70, 130, 180, 0.25);
        }
        .confidence-meter {
            height: 10px;
            background: #FCE4EC;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        .confidence-fill {
            height: 100%;
            background: #4682B4;
            transition: width 0.5s ease;
        }
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 350px;
            height: 70px;
            background: rgba(224, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 1.5rem;
            box-shadow: 0 6px 12px rgba(70, 130, 180, 0.3);
            z-index: 1000;
        }
        .navigation ul {
            display: flex;
            width: 300px;
        }
        .navigation ul li {
            position: relative;
            list-style: none;
            width: 75px;
            height: 70px;
            z-index: 1;
        }
        .navigation ul li a {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
            text-align: center;
            font-weight: 500;
        }
        .navigation ul li a .icon {
            position: relative;
            display: block;
            line-height: 75px;
            font-size: 1.5em;
            text-align: center;
            transition: 0.5s;
        }
        .navigation ul li.active a .icon { transform: translateY(-32px); }
        .navigation ul li a .text {
            position: absolute;
            font-weight: 400;
            font-size: 0.75em;
            letter-spacing: 0.05em;
            transition: 0.5s;
            opacity: 0;
            transform: translateY(20px);
        }
        .navigation ul li.active a .text { opacity: 1; transform: translateY(10px); }
        .indicator {
            position: absolute;
            top: -50%;
            width: 70px;
            height: 70px;
            background: #4682B4;
            border-radius: 50%;
            border: 6px solid #FCE4EC;
            transition: 0.5s;
        }
        .indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -22px;
            width: 20px;
            height: 20px;
            background: transparent;
            border-top-right-radius: 20px;
            box-shadow: 1px -10px 0 0 #FCE4EC;
        }
        .indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -22px;
            width: 20px;
            height: 20px;
            background: transparent;
            border-top-left-radius: 20px;
            box-shadow: -1px -10px 0 0 #FCE4EC;
        }
        .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(calc(75px * 0)); }
        .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(calc(75px * 1)); }
        .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(calc(75px * 2)); }
        .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(calc(75px * 3)); }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .contact-links {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .contact-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            font-size: 12px;
        }
        .contact-link i {
            font-size: 20px;
            margin-bottom: 5px;
        }
        .period-id {
            font-family: monospace;
            letter-spacing: 2px;
            font-size: 1.2rem;
        }
        #currentPeriod, #currentResult {
            border: none !important;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        button, .btn {
            border-radius: 1rem;
            background: rgba(70, 130, 180, 0.9);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        button:hover, .btn:hover {
            background: #E91E63;
            transform: scale(1.05);
        }
        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            background: rgba(224, 255, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
        }
        .loader-hourglass {
            width: 60px;
            height: 80px;
            background: #4682B4;
            clip-path: polygon(25% 0%, 75% 0%, 100% 25%, 75% 50%, 100% 75%, 25% 100%, 0% 75%, 25% 50%, 0% 25%);
            animation: rotate 2s linear infinite;
            position: relative;
        }
        .loader-hourglass::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 20%;
            width: 60%;
            height: 60%;
            background: rgba(255, 255, 255, 0.2);
            clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
            animation: sandFall 2s linear infinite;
        }
        .loader-text {
            font-size: 18px;
            font-family: 'El Messiri', sans-serif;
            color: #C2185B;
            text-align: center;
            margin-top: 10px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes sandFall {
            0% { clip-path: polygon(0% 0%, 100% 0%, 50% 100%); }
            50% { clip-path: polygon(0% 50%, 100% 50%, 50% 100%); }
            100% { clip-path: polygon(0% 0%, 100% 0%, 50% 100%); }
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        @media (max-width: 768px) {
            .card { padding: 0.75rem; margin: 0.5rem; border-radius: 1rem; }
            .grid-cols-2 { grid-template-columns: 1fr; }
            .md\\:grid-cols-3 { grid-template-columns: 1fr 1fr; }
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
            .text-xl { font-size: 1rem; }
            .text-lg { font-size: 0.875rem; }
            .text-sm { font-size: 0.75rem; }
            .p-6 { padding: 0.75rem; }
            .p-5 { padding: 0.5rem; }
            .w-12 { width: 2.5rem; height: 2.5rem; }
            .history-item { padding: 1rem; border-radius: 1rem; }
            .history-item .watermark { font-size: 1rem; }
            .rounded-xl { border-radius: 0.75rem; }
            .gap-4 { gap: 0.75rem; }
            .mb-4 { margin-bottom: 0.75rem; }
            .mb-2 { margin-bottom: 0.5rem; }
            .mb-1 { margin-bottom: 0.3rem; }
            .px-4 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
            .space-x-2 > * + * { margin-left: 0.5rem; }
            .space-x-1 > * + * { margin-left: 0.3rem; }
            .navigation { width: 300px; border-radius: 1rem; }
            .navigation ul { width: 250px; }
            .navigation ul li { width: 62.5px; }
            .indicator { width: 60px; height: 60px; }
            .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(calc(62.5px * 0)); }
            .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(calc(62.5px * 1)); }
            .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(calc(62.5px * 2)); }
            .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(calc(62.5px * 3)); }
            .popup, .modal { max-width: 320px; padding: 1rem; border-radius: 1rem; }
            .loader-hourglass { width: 50px; height: 70px; }
            .loader-text { font-size: 16px; }
        }

        /* Styles from LOGINPAGETR.HTML for the login page */
        .login-container {
            background: var(--white);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(135, 206, 235, 0.15);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 2;
            border: 1px solid var(--primary-light);
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .login-container.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .login-container:hover {
            box-shadow: 0 12px 25px rgba(135, 206, 235, 0.2);
            transform: translateY(-3px);
        }

        .logo-container {
            text-align: center;
            transform: scale(0.9);
            opacity: 0;
        }

        .title {
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 1.7rem;
            margin-top: 0;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .last-key {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .error-message {
            color: #D32F2F;
            text-align: center;
            margin-top: 0.8rem;
            font-weight: 500;
            font-size: 0.9rem;
            transform: scale(0.95);
            opacity: 0;
            padding: 8px;
            border-radius: 6px;
            background-color: rgba(211, 47, 47, 0.05);
            border-left: 3px solid #D32F2F;
        }

        .success-message {
            color: #28a745;
            text-align: center;
            margin-top: 0.8rem;
            font-weight: 500;
            font-size: 0.9rem;
            transform: scale(0.95);
            opacity: 0;
            padding: 8px;
            border-radius: 6px;
            background-color: rgba(40, 167, 69, 0.05);
            border-left: 3px solid #28a745;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.2rem;
            transform: translateX(-20px);
            opacity: 0;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-dark);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field {
            width: 100%;
            padding: 12px 18px 12px 45px;
            border-radius: 10px;
            border: 1px solid var(--primary-light);
            background-color: var(--white);
            font-size: 0.95rem;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 3px rgba(70, 130, 180, 0.15);
        }

        .input-field:focus + .input-icon {
            transform: translateY(-50%) scale(1.1);
            color: var(--secondary);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--white);
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            transform: translateY(20px);
            opacity: 0;
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.2);
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.5s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(135, 206, 235, 0.3);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .copy-btn {
            background: var(--primary-light);
            border: none;
            color: var(--primary-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px 18px;
            border-radius: 8px;
            margin-top: 0.8rem;
            transform: translateY(20px);
            opacity: 0;
            box-shadow: 0 3px 10px rgba(135, 206, 235, 0.1);
        }

        .copy-btn:hover {
            background: var(--primary-dark);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.2);
        }

        .copy-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            left: -100%;
            top: 0;
            transition: all 0.3s ease;
        }

        .copy-btn.copied .copy-animation {
            left: 0;
        }

        .loading-message {
            color: var(--primary-dark);
            text-align: center;
            margin-top: 0.8rem;
            font-weight: 500;
            display: none;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: linear-gradient(to bottom right, var(--primary), var(--secondary));
            box-shadow: 0 3px 10px rgba(135, 206, 235, 0.2);
        }

        .social-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.3);
        }

        .floating-element {
            position: absolute;
            background-color: var(--primary-light);
            border-radius: 50%;
            z-index: 1;
            filter: blur(1px);
            opacity: 0.5;
        }

        .star {
            position: absolute;
            background-color: var(--white);
            border-radius: 50%;
            z-index: 1;
            animation: twinkle var(--duration) infinite ease-in-out;
            opacity: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: var(--primary-dark);
            opacity: 0;
            z-index: 10;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 1.5rem;
            }

            .title {
                font-size: 1.4rem;
            }

            .last-key, .error-message, .success-message {
                font-size: 0.8rem;
            }

            .input-field {
                padding: 10px 15px 10px 40px;
                font-size: 0.9rem;
            }

            .submit-btn, .copy-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="app-container" class="w-full h-full flex flex-col items-center justify-center">
        <!-- Login Section -->
        <div id="login-section" class="absolute inset-0 flex items-center justify-center p-4" style="display: none;">
            <div class="floating-element" style="width: 150px; height: 150px; top: 15%; left: 10%; background: radial-gradient(circle, var(--primary-light), transparent 70%);"></div>
            <div class="floating-element" style="width: 100px; height: 100px; bottom: 20%; right: 12%; background: radial-gradient(circle, var(--primary-light), transparent 70%);"></div>
            <div class="floating-element" style="width: 80px; height: 80px; top: 35%; right: 18%; background: radial-gradient(circle, var(--primary-light), transparent 70%);"></div>
            <div class="floating-element" style="width: 120px; height: 120px; bottom: 30%; left: 15%; background: radial-gradient(circle, var(--primary-light), transparent 70%);"></div>

            <div id="stars-container"></div>
            <div id="confetti-container"></div>

            <div class="login-container" id="loginContainer">
                <div class="logo-container">
                    <h1 class="title">QUINTUS ULTRA</h1>
                    <div class="error-message" id="error"></div>
                    <div class="success-message" id="success"></div>
                </div>

                <div class="input-group" id="inputGroup">
                    <i class="fas fa-key input-icon"></i>
                    <input type="text" id="accessKey" placeholder="Enter License Key" required class="input-field">
                </div>

                <div class="loading-message" id="loading">Loading...</div>

                <button class="submit-btn" id="submitBtn" onclick="handleLogin()">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </button>

                <div class="text-center mt-4">
                    <button class="copy-btn" id="copyBtn" onclick="copyDeviceId()">
                        <span class="copy-animation"></span>
                        <i class="fas fa-copy mr-2"></i>
                        <span id="copyText">Copy Device ID</span>
                    </button>
                </div>

                <div class="text-center mt-4">
                    <button class="copy-btn" onclick="getKey()">
                        <i class="fas fa-key mr-2"></i> Get Access Key
                    </button>
                </div>

                <div class="social-links" id="socialLinks">
                    <a href="https://t.me/TOJI_X_OWNER1" target="_blank" class="social-link" title="Telegram">
                        <i class="fab fa-telegram"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="main-app-section" class="w-full relative pb-20" style="display: none;">
            <header class="text-center mt-0 mb-2 animate__animated animate__fadeInDown">
                <svg viewBox="0 0 800 120">
                    <text x="50%" y="50%">QUINTUS ULTRA</text>
                </svg>
            </header>

            <div class="max-w-full mx-auto p-2 w-full">
                <div class="max-w-4xl mx-auto p-2 w-full">
                    <!-- Home Section -->
                    <div id="homeSection" class="content-section active">
                        <div class="card mb-4 overflow-hidden gradient-bg animate__animated animate__zoomIn relative">
                            <div class="bg-white bg-opacity-95 p-6 rounded-lg pulse-animation">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="relative">
                                        <div class="pl-2">
                                            <div class="flex items-center space-x-2 mb-2">
                                                <i class="fas fa-calendar-alt text-2xl animate__animated animate__bounce"></i>
                                                <h2 class="text-2xl font-bold" data-lang-key="period">Period</h2>
                                            </div>
                                            <p id="currentPeriod" class="text-2xl font-semibold bg-E91E63 p-3 rounded-lg shadow-inner period-id">-</p>
                                        </div>
                                    </div>
                                    <div class="relative text-right">
                                        <div class="flex items-center justify-end space-x-2 mb-2">
                                            <h2 class="text-2xl font-bold" data-lang-key="prediction">Prediction</h2>
                                            <i class="fas fa-poll text-2xl animate__animated animate__bounce"></i>
                                        </div>
                                        <p id="currentResult" class="text-2xl font-semibold bg-E91E63 p-3 rounded-lg shadow-inner">-</p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <p class="text-sm" data-lang-key="confidence">Confidence</p>
                                    <div class="confidence-meter">
                                        <div id="confidenceFill" class="confidence-fill" style="width: 0%"></div>
                                    </div>
                                    <p id="confidenceText" class="text-sm mt-1">0%</p>
                                </div>
                            </div>
                            <div class="small-dot" style="top: 15%; left: 15%; animation-delay: 0.2s;"></div>
                            <div class="small-dot" style="top: 85%; left: 85%; animation-delay: 0.8s;"></div>
                            <div class="small-dot" style="top: 50%; left: 25%; animation-delay: 1.2s;"></div>
                            <div class="small-dot" style="top: 20%; left: 80%; animation-delay: 1.6s;"></div>
                        </div>

                        <div class="card mb-4 p-6 animate__animated animate__fadeInUp relative">
                            <h2 class="text-3xl font-bold text-center mb-4 relative">
                                <span class="relative z-10 pulse-animation" data-lang-key="analysis_dashboard">Analysis Dashboard</span>
                                <span class="absolute top-1/2 left-0 w-full h-2 bg-E91E63 -translate-y-1/2 rounded-full"></span>
                            </h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-star text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="most_frequent">Most Frequent</p>
                                            <p id="mostFrequent" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-arrow-down text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="least_frequent">Least Frequent</p>
                                            <p id="leastFrequent" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-percentage text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="win_rate">Win Rate</p>
                                            <p id="winRate" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.3s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="wins">Wins</p>
                                            <p id="totalWinBets" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.4s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-skull text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="losses">Losses</p>
                                            <p id="totalLossBets" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card flex items-center justify-between animate__animated animate__fadeIn" style="animation-delay: 0.5s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-server text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="server_status">Server Status</p>
                                            <p id="serverStatus" class="font-semibold" data-lang-key="connected">Connected</p>
                                        </div>
                                    </div>
                                    <div id="serverStatusIndicator" class="w-3 h-3 bg-4682B4 rounded-full animate-ping"></div>
                                </div>
                            </div>
                            <div class="small-dot" style="top: 10%; left: 10%; animation-delay: 0.3s;"></div>
                            <div class="small-dot" style="top: 90%; left: 90%; animation-delay: 0.9s;"></div>
                            <div class="small-dot" style="top: 30%; left: 70%; animation-delay: 1.5s;"></div>
                        </div>
                    </div>

                    <!-- History Section -->
                    <div id="historySection" class="content-section">
                        <div class="card p-6 animate__animated animate__fadeInUp relative">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-3xl font-bold text-center relative">
                                    <span class="relative z-10 pulse-animation" data-lang-key="history">History</span>
                                    <span class="absolute top-1/2 left-0 w-full h-2 bg-E91E63 -translate-y-1/2 rounded-full"></span>
                                </h2>
                                <button id="deleteAllHistoryBtn" class="px-4 py-2 rounded-lg hover:bg-E91E63 transition flex items-center">
                                    <i class="fas fa-trash-alt mr-2"></i><span data-lang-key="delete">Delete</span>
                                </button>
                            </div>
                            <div id="history" class="history-container"></div>
                            <div class="small-dot" style="top: 20%; left: 30%; animation-delay: 0.4s;"></div>
                            <div class="small-dot" style="top: 80%; left: 70%; animation-delay: 0.9s;"></div>
                            <div class="small-dot" style="top: 40%; left: 50%; animation-delay: 1.3s;"></div>
                        </div>
                    </div>

                    <!-- Stats Section -->
                    <div id="statsSection" class="content-section">
                        <div class="card p-6 animate__animated animate__fadeInUp relative">
                            <h2 class="text-3xl font-bold text-center mb-4 relative">
                                <span class="relative z-10 pulse-animation" data-lang-key="statistics">Statistics</span>
                                <span class="absolute top-1/2 left-0 w-full h-2 bg-E91E63 -translate-y-1/2 rounded-full"></span>
                            </h2>
                            <div class="stats-grid">
                                <div class="dashboard-card">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-green-500 text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="total_wins">Total Wins</p>
                                            <p id="statsTotalWins" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-skull text-red-500 text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="total_losses">Total Losses</p>
                                            <p id="statsTotalLosses" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-percentage text-yellow-500 text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="win_rate">Win Rate</p>
                                            <p id="statsWinRate" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-fire text-orange-500 text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="current_streak">Current Streak</p>
                                            <p id="currentStreak" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-history text-blue-500 text-lg"></i>
                                        <div>
                                            <p class="text-sm" data-lang-key="last_five_results">Last 5 Results</p>
                                            <p id="lastFiveResults" class="text-xl font-bold">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="small-dot" style="top: 15%; left: 20%; animation-delay: 0.5s;"></div>
                            <div class="small-dot" style="top: 85%; left: 80%; animation-delay: 1s;"></div>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div id="aboutSection" class="content-section">
                        <div class="card p-6 animate__animated animate__fadeInUp relative">
                            <h2 class="text-3xl font-bold text-center mb-4 relative">
                                <span class="relative z-10 pulse-animation" data-lang-key="about_us">About Us</span>
                                <span class="absolute top-1/2 left-0 w-full h-2 bg-E91E63 -translate-y-1/2 rounded-full"></span>
                            </h2>
                            <div class="flex flex-col gap-4">
                                <div class="dashboard-card">
                                    <h3 class="text-xl font-semibold mb-2" data-lang-key="ai_features_title">AI Features</h3>
                                    <ul class="list-disc list-inside text-sm space-y-1">
                                        <li data-lang-key="feature_realtime">Real-time Prediction Analysis</li>
                                        <li data-lang-key="feature_confidence">Advanced Confidence Scoring</li>
                                        <li data-lang-key="feature_history_analysis">Comprehensive Historical Data Analysis</li>
                                        <li data-lang-key="feature_trend_detection">Intelligent Trend Detection</li>
                                        <li data-lang-key="feature_notifications">Instant Prediction Notifications</li>
                                    </ul>
                                </div>
                                <div class="dashboard-card">
                                    <h3 class="text-xl font-semibold mb-2" data-lang-key="owner_info_title">Owner Information</h3>
                                    <p class="text-sm">
                                        <span data-lang-key="owner_name">Owner:</span> TOJI X OWNER1
                                    </p>
                                    <p class="text-sm flex items-center space-x-2 mt-1">
                                        <i class="fab fa-telegram text-lg"></i>
                                        <a href="https://t.me/TOJI_X_OWNER1" target="_blank" class="hover:underline text-4682B4">@TOJI_X_OWNER1</a>
                                    </p>
                                </div>
                                <div class="dashboard-card">
                                    <h3 class="text-xl font-semibold mb-2" data-lang-key="disclaimer_title">Disclaimer</h3>
                                    <p class="text-xs" data-lang-key="disclaimer_text">
                                        QUINTUS ULTRA provides predictions for informational and entertainment purposes only. We do not guarantee the accuracy of any predictions and strongly advise against making financial decisions based solely on the information provided. Users are solely responsible for their actions. This application is not intended as financial advice.
                                    </p>
                                </div>
                            </div>
                            <div class="small-dot" style="top: 10%; left: 15%; animation-delay: 0.6s;"></div>
                            <div class="small-dot" style="top: 90%; left: 85%; animation-delay: 1.1s;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <ul>
                    <li class="active">
                        <a href="#" data-section="homeSection">
                            <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                            <span class="text" data-lang-key="home">Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="historySection">
                            <span class="icon"><ion-icon name="time-outline"></ion-icon></span>
                            <span class="text" data-lang-key="history">History</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="statsSection">
                            <span class="icon"><ion-icon name="bar-chart-outline"></ion-icon></span>
                            <span class="text" data-lang-key="stats">Stats</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="aboutSection">
                            <span class="icon"><ion-icon name="information-circle-outline"></ion-icon></span>
                            <span class="text" data-lang-key="about">About</span>
                        </a>
                    </li>
                    <div class="indicator"></div>
                </ul>
            </div>

            <!-- Video Popup -->
            <div id="videoPopup" class="popup">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold" data-lang-key="how_to_use_newro_x">How To Use QUINTUS ULTRA</h3>
                    <button onclick="closeVideoPopup()" class="hover:text-4682B4">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>

            <!-- Confirmation Modal -->
            <div id="confirmModal" class="modal">
                <h3 class="text-lg font-semibold mb-4" data-lang-key="confirm_action">Confirm Action</h3>
                <p id="modalMessage" class="mb-4"></p>
                <div class="flex justify-end space-x-2">
                    <button id="cancelModalBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition" data-lang-key="cancel">Cancel</button>
                    <button id="confirmModalBtn" class="px-4 py-2 rounded-lg hover:bg-E91E63 transition" data-lang-key="confirm">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Authentication & UI Display Logic ---
        const loginSection = document.getElementById('login-section');
        const mainAppSection = document.getElementById('main-app-section');
        const body = document.body;

        function showLogin() {
            mainAppSection.style.display = 'none';
            loginSection.style.display = 'flex';
            body.classList.add('login-body'); // Apply login-specific background
            // Trigger login page animations
            gsap.to('#loginContainer', {
                opacity: 1,
                visibility: 'visible',
                y: 0,
                duration: 0.7,
                ease: 'power3.out',
                onComplete: () => {
                    document.getElementById('loginContainer').classList.add('visible');
                }
            });
            gsap.to('.logo-container', { scale: 1, opacity: 1, duration: 0.6, delay: 0.15, ease: 'elastic.out(1, 0.6)' });
            gsap.to('#inputGroup', { x: 0, opacity: 1, duration: 0.5, delay: 0.3, ease: 'power2.out' });
            gsap.to('#submitBtn', { y: 0, opacity: 1, duration: 0.5, delay: 0.6, ease: 'power2.out' });
            gsap.to('#copyBtn', { y: 0, opacity: 1, duration: 0.5, delay: 0.75, ease: 'power2.out' });
            gsap.to('#socialLinks', {
                y: 0, opacity: 1, duration: 0.5, delay: 0.9, ease: 'power2.out', onComplete: () => {
                    gsap.to('.social-link', { y: -8, duration: 0.4, stagger: 0.08, repeat: -1, yoyo: true, ease: 'sine.inOut' });
                }
            });
            gsap.to('.floating-element', { y: 15, rotation: 3, duration: 4, repeat: -1, yoyo: true, ease: 'sine.inOut', stagger: 0.2 });
        }

        function showMainApp() {
            loginSection.style.display = 'none';
            mainAppSection.style.display = 'block';
            body.classList.remove('login-body'); // Remove login-specific background
            initializeApp(); // Initialize main app logic
        }

        // --- Login Page Specific Functions ---

        // Function to generate and retrieve a unique device ID
        function getDeviceId() {
            let id = localStorage.getItem("device_id");
            if (!id) {
                if (crypto.randomUUID) {
                    id = crypto.randomUUID();
                } else {
                    id = 'id-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
                }
                localStorage.setItem("device_id", id);
            }
            return id;
        }
        
        // Function to display messages on the login form
        function showLoginMessage(type, message) {
            const errorDiv = document.getElementById("error");
            const successDiv = document.getElementById("success");
            const targetDiv = type === 'error' ? errorDiv : successDiv;
            const otherDiv = type === 'error' ? successDiv : errorDiv;

            otherDiv.innerText = "";
            gsap.to(otherDiv, { opacity: 0, scale: 0.95, duration: 0.3 });
            
            targetDiv.innerText = message;
            gsap.to(targetDiv, { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
        }

        // --- SECURE LOGIN HANDLER ---
        // This function now validates against the Firebase Realtime Database
        window.handleLogin = async function () {
            const key = document.getElementById("accessKey").value.trim();
            const deviceId = getDeviceId();
            const loadingDiv = document.getElementById("loading");
            const MAX_ATTEMPTS = 3;

            if (!key) {
                showLoginMessage('error', "Please enter an access key.");
                return;
            }

            loadingDiv.style.display = 'block';
            document.getElementById('submitBtn').disabled = true;

            try {
                // 1. Check if device is banned
                const bannedRef = window.dbChild(window.dbRef(window.firebaseDb), `bannedDevices/${deviceId}`);
                const bannedSnapshot = await window.dbGet(bannedRef);
                if (bannedSnapshot.exists()) {
                    showLoginMessage('error', "This device has been banned due to multiple failed login attempts.");
                    loadingDiv.style.display = 'none';
                    document.getElementById('submitBtn').disabled = false;
                    return;
                }

                // 2. Check login attempts
                const attemptsRef = window.dbChild(window.dbRef(window.firebaseDb), `loginAttempts/${deviceId}`);
                const attemptsSnapshot = await window.dbGet(attemptsRef);
                let currentAttempts = attemptsSnapshot.val() || 0;

                if (currentAttempts >= MAX_ATTEMPTS) {
                    await window.dbSet(bannedRef, true); // Ban the device
                    showLoginMessage('error', "This device has been banned. Please contact support.");
                    loadingDiv.style.display = 'none';
                    document.getElementById('submitBtn').disabled = false;
                    return;
                }

                // 3. Validate the key
                const keyRef = window.dbChild(window.dbRef(window.firebaseDb), `accessKeys/${key}`);
                const keySnapshot = await window.dbGet(keyRef);

                if (!keySnapshot.exists()) {
                    currentAttempts++;
                    await window.dbSet(attemptsRef, currentAttempts);
                    showLoginMessage('error', `Invalid key. You have ${MAX_ATTEMPTS - currentAttempts} attempts left.`);
                } else {
                    const keyData = keySnapshot.val();
                    if (keyData.deviceId !== deviceId) {
                        currentAttempts++;
                        await window.dbSet(attemptsRef, currentAttempts);
                        showLoginMessage('error', `This key is not for this device. ${MAX_ATTEMPTS - currentAttempts} attempts left.`);
                    } else if (keyData.active === false) {
                        showLoginMessage('error', "This key has been deactivated.");
                    } else if (keyData.expiry < Date.now()) {
                        showLoginMessage('error', "This key has expired.");
                    } else {
                        // SUCCESS!
                        await window.dbSet(attemptsRef, 0); // Reset attempts on success
                        showLoginMessage('success', "Login Successful! Loading app...");
                        localStorage.setItem('isLoggedIn', 'true');
                        setTimeout(() => {
                            showMainApp();
                        }, 1500);
                        return; // Exit function on success
                    }
                }
            } catch (error) {
                console.error("Login validation error:", error);
                showLoginMessage('error', "An error occurred. Please try again.");
            }
            
            // This part only runs if login failed
            loadingDiv.style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
        };


        // Function to open Telegram chat for getting key
        window.getKey = function () {
            const message = encodeURIComponent("HELLO @TOJI_X_OWNER1, I NEED AN ACCESS KEY.");
            window.open(`https://t.me/TOJI_X_OWNER1?text=${message}`, '_blank');
        };

        // Copies the device ID to clipboard
        function copyDeviceId() {
            const deviceId = getDeviceId();
            if (document.execCommand) { 
                const tempInput = document.createElement('textarea');
                tempInput.value = deviceId;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand('copy');
                    const copyBtn = document.getElementById('copyBtn');
                    const copyText = document.getElementById('copyText');

                    createConfetti(); 
                    animateConfetti();

                    copyBtn.classList.add('copied');
                    copyText.innerHTML = 'Copied!';

                    gsap.to(copyBtn, {
                        scale: 1.08,
                        duration: 0.15,
                        yoyo: true,
                        repeat: 1,
                        ease: 'power2.inOut',
                        onComplete: () => {
                            setTimeout(() => {
                                copyBtn.classList.remove('copied');
                                copyText.innerHTML = 'Copy Device ID';
                            }, 1200);
                        }
                    });
                } catch (err) {
                    console.error('Failed to copy: ', err);
                } finally {
                    document.body.removeChild(tempInput);
                }
            }
        }

        // Creates floating star elements for background animation
        function createStars() {
            const container = document.getElementById('stars-container');
            if (!container) return; 
            container.innerHTML = ''; 
            const starCount = 40;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');

                const size = Math.random() * 2 + 1;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const duration = Math.random() * 4 + 2 + 's';
                const delay = Math.random() * 4 + 's';

                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${posX}%`;
                star.style.top = `${posY}%`;
                star.style.setProperty('--duration', duration);
                star.style.animationDelay = delay;

                container.appendChild(star);
            }
        }

        // Creates confetti elements for copy animation
        function createConfetti() {
            const container = document.getElementById('confetti-container');
            if (!container) return; 
            container.innerHTML = ''; 
            const confettiCount = 80;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');

                const size = Math.random() * 8 + 4;
                const posX = Math.random() * window.innerWidth;
                const posY = -20;
                const color = `hsl(${Math.random() * 180 + 180}, 80%, 70%)`; 
                const rotation = Math.random() * 360;
                const shape = Math.random() > 0.5 ? '50%' : '0'; 

                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.left = `${posX}px`;
                confetti.style.top = `${posY}px`;
                confetti.style.backgroundColor = color;
                confetti.style.borderRadius = shape;
                confetti.style.transform = `rotate(${rotation}deg)`;

                container.appendChild(confetti);
            }
        }

        // Animates the created confetti elements
        function animateConfetti() {
            const confetti = document.querySelectorAll('.confetti');

            confetti.forEach((piece, index) => {
                const duration = Math.random() * 2.5 + 1.5;
                const delay = index * 0.015;

                gsap.to(piece, {
                    y: window.innerHeight + 80, 
                    x: `+=${Math.random() * 150 - 75}`, 
                    rotation: Math.random() * 360, 
                    opacity: 1,
                    duration: duration,
                    delay: delay,
                    ease: 'power1.out',
                    onComplete: () => {
                        piece.remove(); 
                    }
                });
            });
        }

        // Event listeners for login page elements
        document.addEventListener('DOMContentLoaded', () => {
            const licenseInput = document.getElementById('accessKey');
            const submitBtn = document.getElementById('submitBtn');

            if (licenseInput) {
                licenseInput.addEventListener('focus', () => {
                    gsap.to('.input-icon', { scale: 1.1, duration: 0.25, ease: 'back.out' });
                });
                licenseInput.addEventListener('blur', () => {
                    gsap.to('.input-icon', { scale: 1, duration: 0.25, ease: 'back.out' });
                });
            }

            if (submitBtn) {
                submitBtn.addEventListener('mouseenter', () => {
                    gsap.to(submitBtn, { y: -2, duration: 0.25, ease: 'power2.out' });
                });
                submitBtn.addEventListener('mouseleave', () => {
                    gsap.to(submitBtn, { y: 0, duration: 0.25, ease: 'power2.out' });
                });
            }
            createStars();
        });


        // --- Main App Specific Logic ---

        const translations = {
            en: {
                period: "Period",
                prediction: "Prediction",
                confidence: "Confidence",
                analysis_dashboard: "Analysis Dashboard",
                most_frequent: "Most Frequent",
                least_frequent: "Least Frequent",
                win_rate: "Win Rate",
                wins: "Wins",
                losses: "Losses",
                server_status: "Server Status",
                connected: "Connected",
                disconnected: "Disconnected",
                history: "History",
                delete: "Delete",
                statistics: "Statistics",
                total_wins: "Total Wins",
                total_losses: "Total Losses",
                current_streak: "Current Streak",
                last_five_results: "Last 5 Results",
                about: "About",
                about_us: "About Us",
                ai_features_title: "AI Features",
                feature_realtime: "Real-time Prediction Analysis",
                feature_confidence: "Advanced Confidence Scoring",
                feature_history_analysis: "Comprehensive Historical Data Analysis",
                feature_trend_detection: "Intelligent Trend Detection",
                feature_notifications: "Instant Prediction Notifications",
                owner_info_title: "Owner Information",
                owner_name: "Owner:",
                disclaimer_title: "Disclaimer",
                disclaimer_text: "QUINTUS ULTRA provides predictions for informational and entertainment purposes only. We do not guarantee the accuracy of any predictions and strongly advise against making financial decisions based solely on the information provided. Users are solely responsible for their actions. This application is not intended as financial advice.",
                how_to_use_newro_x: "How To Use QUINTUS ULTRA",
                confirm_action: "Confirm Action",
                cancel: "Cancel",
                confirm: "Confirm",
                pending: "Pending",
                delete_item_confirm: "Are you sure you want to delete this history item?",
                delete_all_confirm: "Are you sure you want to delete all history items?",
                reset_settings_confirm: "Are you sure you want to reset all settings to default?"
            },
            hi: {
                period: "",
                prediction: "",
                confidence: "",
                analysis_dashboard: " ",
                most_frequent: "  ",
                least_frequent: "  ",
                win_rate: "  ",
                wins: "",
                losses: "",
                server_status: " ",
                connected: " ",
                disconnected: "  ",
                history: "",
                delete: "",
                statistics: "",
                total_wins: " ",
                total_losses: " ",
                current_streak: " ",
                last_five_results: " 5 ",
                about: "  ",
                about_us: "  ",
                ai_features_title: " ",
                feature_realtime: "   ",
                feature_confidence: "  ",
                feature_history_analysis: "   ",
                feature_trend_detection: "    ",
                feature_notifications: "  ",
                owner_info_title: "  ",
                owner_name: ":",
                disclaimer_title: "",
                disclaimer_text: "                                                              ",
                how_to_use_newro_x: "     ",
                confirm_action: "   ",
                cancel: " ",
                confirm: " ",
                pending: "",
                delete_item_confirm: "        ?",
                delete_all_confirm: "        ?",
                reset_settings_confirm: "          ?"
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'en';
        let isSoundEnabled = localStorage.getItem('sound') === 'true' || true;
        let isNotificationsEnabled = localStorage.getItem('notifications') === 'true' || false;

        const state = {
            lastPeriodNumber: null,
            history: [],
            currentResult: null,
            pendingResult: null,
            stats: { winCount: 0, lossStreak: 0, totalBets: 0, totalWins: 0, totalLosses: 0 },
            isResultProcessing: false,
            cachedData: [],
            lastResults: { bigsmall: [] },
            currentPrediction: null,
            currentPeriod: null,
            lastTimerUpdate: 0
        };

        function updateLanguage() {
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                element.textContent = translations[currentLanguage][key] || element.textContent;
            });
        }

        const navItems = document.querySelectorAll('.navigation ul li');
        const sections = document.querySelectorAll('.content-section');

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                const sectionId = item.querySelector('a').getAttribute('data-section');
                sections.forEach(section => section.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');

                const index = Array.from(navItems).indexOf(item);
                const itemWidth = window.innerWidth <= 768 ? 62.5 : 75;
                document.querySelector('.indicator').style.transform = `translateX(calc(${itemWidth}px * ${index}))`;

                updatePredictionDisplay();
            });
        });

        function openVideoPopup() {
            document.getElementById('videoPopup').classList.add('active');
            if (isSoundEnabled) {
                new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play();
            }
        }

        function closeVideoPopup() {
            document.getElementById('videoPopup').classList.remove('active');
            if (isSoundEnabled) {
                new Audio('https://www.soundjay.com/buttons/beep-02.mp3').play();
            }
        }

        function showConfirmModal(message, onConfirm) {
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
            const confirmBtn = document.getElementById('confirmModalBtn');
            const cancelBtn = document.getElementById('cancelModalBtn');

            const confirmHandler = () => {
                onConfirm();
                document.getElementById('confirmModal').classList.remove('active');
                confirmBtn.removeEventListener('click', confirmHandler);
                if (isSoundEnabled) {
                    new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play();
                }
            };

            confirmBtn.addEventListener('click', confirmHandler);
            cancelBtn.addEventListener('click', () => {
                document.getElementById('confirmModal').classList.remove('active');
                if (isSoundEnabled) {
                    new Audio('https://www.soundjay.com/buttons/beep-02.mp3').play();
                }
            });
        }

        const apiCache = new Map();
        const CACHE_DURATION = 30000;
        async function fetchOptimizedData(maxPages = 2) { 
            const cacheKey = 'optimized-data';
            const cached = apiCache.get(cacheKey);
            if (cached && Date.now() - cached.timestamp < CACHE_DURATION && cached.data.length >= 20) { 
                return cached.data.slice(0, 20); 
            }
            try {
                const promises = Array.from({length: maxPages}, (_, i) => fetchOptimizedPage(i + 1));
                const results = await Promise.allSettled(promises);
                const allData = results
                    .filter(result => result.status === 'fulfilled')
                    .flatMap(result => result.value);
                state.cachedData = allData;
                apiCache.set(cacheKey, { data: allData, timestamp: Date.now() });
                return allData.slice(0, 20); 
            } catch (error) {
                console.error('Error fetching optimized data:', error);
                updateServerStatus(false);
                return state.cachedData.slice(0, 20) || [];
            }
        }

        async function fetchOptimizedPage(page) {
            const cacheKey = `page-${page}`;
            const cached = apiCache.get(cacheKey);
            if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
                return cached.data;
            }
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                const response = await fetch("https://ckyjgfr.com/api/webapi/GetNoaverageEmerdList", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Cache-Control": "no-cache" },
                    body: JSON.stringify({
                        pageSize: 10,
                        pageNo: page,
                        typeId: 1,
                        language: 0,
                        random: "fcc5f4ef6583416ab2439096e1c67c62",
                        signature: "B24ACE2541B8C543DF6F20ACEE7E3EBE",
                        timestamp: Math.floor(Date.now() / 1000)
                    }),
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                const result = data?.data?.list || [];
                apiCache.set(cacheKey, { data: result, timestamp: Date.now() });
                return result;
            } catch (error) {
                console.error(`Error fetching page ${page}:`, error);
                return [];
            }
        }

        function getBigSmallFromNumber(number) {
            const num = parseInt(number, 10);
            if (isNaN(num)) return null;
            return num >= 0 && num <= 4 ? 'SMALL' : num >= 5 && num <= 9 ? 'BIG' : null;
        }

        async function generateQuantumPrediction(historyData) {
            const recentResults = historyData.slice(0, 20).map(item => getBigSmallFromNumber(item.number)).filter(Boolean); 

            let bigCount = 0;
            let smallCount = 0;
            recentResults.forEach(result => {
                if (result === 'BIG') bigCount++;
                else smallCount++;
            });

            let prediction = 'BIG';
            let probability = 50; 

            if (bigCount > smallCount + 3) { 
                prediction = 'SMALL'; 
                probability = 60 + (bigCount - smallCount); 
            } else if (smallCount > bigCount + 3) { 
                prediction = 'BIG'; 
                probability = 60 + (smallCount - bigCount); 
            } else {
                if (recentResults.length >= 2) {
                    if (recentResults[0] === recentResults[1]) { 
                        prediction = (recentResults[0] === 'BIG') ? 'SMALL' : 'BIG';
                        probability = 55;
                    } else { 
                        prediction = (recentResults[0] === 'BIG') ? 'SMALL' : 'BIG';
                        probability = 52;
                    }
                } else {
                    prediction = Math.random() > 0.5 ? 'BIG' : 'SMALL';
                    probability = 50;
                }
            }

            probability = Math.min(90, Math.max(50, probability));

            return {
                result: prediction,
                probability: probability
            };
        }

        function updateServerStatus(isConnected) {
            const statusElement = document.getElementById('serverStatus');
            const indicator = document.getElementById('serverStatusIndicator');
            if (statusElement && indicator) { 
                if (isConnected) {
                    statusElement.textContent = translations[currentLanguage].connected;
                    indicator.classList.add('animate-ping', 'bg-4682B4');
                    indicator.classList.remove('bg-gray-500');
                } else {
                    statusElement.textContent = translations[currentLanguage].disconnected;
                    indicator.classList.remove('animate-ping', 'bg-4682B4');
                    indicator.classList.add('bg-gray-500');
                }
            }
        }

        function updatePredictionDisplay() {
            const currentPeriodEl = document.getElementById('currentPeriod');
            const currentResultEl = document.getElementById('currentResult');
            const confidenceFillEl = document.getElementById('confidenceFill');
            const confidenceTextEl = document.getElementById('confidenceText');

            if (!currentPeriodEl || !currentResultEl || !confidenceFillEl || !confidenceTextEl) {
                console.warn("Prediction display elements not found. Skipping update.");
                return;
            }

            if (state.currentPrediction) {
                currentPeriodEl.textContent = state.lastPeriodNumber.slice(-5);
                currentResultEl.textContent = `${state.currentPrediction.result}`;
                confidenceFillEl.style.width = `${state.currentPrediction.probability}%`;
                confidenceTextEl.textContent = `${state.currentPrediction.probability}%`;
            } else {
                currentPeriodEl.textContent = state.lastPeriodNumber ? state.lastPeriodNumber.slice(-5) : '-';
                currentResultEl.innerHTML = `
                    <div class="loader">
                        <div class="loader-hourglass"></div>
                        <div class="loader-text">Generating Prediction...</div>
                    </div>`;
                confidenceFillEl.style.width = '0%';
                confidenceTextEl.textContent = '0%';
            }
        }

        async function generateResult(period) {
            if (state.isResultProcessing || (state.currentPrediction && state.currentPeriod === period)) {
                return;
            }
            state.isResultProcessing = true;

            updatePredictionDisplay(); 

            try {
                const historicalData = await fetchOptimizedData();
                const startTime = performance.now();
                const prediction = await generateQuantumPrediction(historicalData);
                const elapsed = performance.now() - startTime;
                const delay = Math.max(0, 1500 - elapsed);
                await new Promise(resolve => setTimeout(resolve, delay));

                state.currentResult = prediction.result;
                state.currentPrediction = { result: prediction.result, probability: prediction.probability };
                state.currentPeriod = period;

                const historyEntry = {
                    period: period.slice(-5),
                    prediction: prediction.result,
                    probability: prediction.probability,
                    status: "predicted"
                };
                state.history.unshift(historyEntry);
                state.lastResults.bigsmall.unshift(prediction.result);
                if (state.lastResults.bigsmall.length > 5) state.lastResults.bigsmall.pop();

                updatePredictionDisplay(); 

                updateHistory();
                updateStats();
                updateAnalysisDashboard();

                if (isNotificationsEnabled && Notification.permission === 'granted') {
                    new Notification(`New Prediction: ${prediction.result}`, {
                        body: `Period: ${period.slice(-5)}\nConfidence: ${prediction.probability}%`,
                        icon: 'https://via.placeholder.com/32'
                    });
                }
            } catch (error) {
                console.error("Error in generateResult:", error);
                document.getElementById('currentResult').textContent = 'PREDICTION ERROR';
                document.getElementById('confidenceFill').style.width = '0%';
                document.getElementById('confidenceText').textContent = '0%';
                updateServerStatus(false);
            } finally {
                state.isResultProcessing = false;
            }
        }

        function updateHistory() {
            const historyContainer = document.getElementById('history');
            if (!historyContainer) return;

            historyContainer.innerHTML = '';
            const recentHistory = state.history.slice(0, 10);
            recentHistory.forEach((entry, index) => {
                const status = entry.status.toLowerCase();
                const iconClass = {
                    predicted: 'fas fa-check-circle predicted-icon',
                    pending: 'fas fa-hourglass-half pending-icon'
                }[status] || 'fas fa-question-circle';
                const badgeClass = {
                    predicted: 'predicted-badge',
                    pending: 'pending-badge'
                }[status] || '';

                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${status} flex items-center justify-between p-4 rounded-xl`;
                historyItem.innerHTML = `
                    <div class="watermark">QUINTUS ULTRA</div>
                    <div class="flex items-center space-x-3">
                        <div class="status-icon ${badgeClass}">
                            <i class="${iconClass}"></i>
                        </div>
                        <div>
                            <p class="text-lg font-semibold">Period: ${entry.period}</p>
                            <p class="text-sm">Predicted: ${entry.prediction}</p>
                            ${entry.probability ? `<p class="text-sm">Confidence: ${entry.probability}%</p>` : ''}
                        </div>
                    </div>
                    <button class="delete-btn hover:text-4682B4 transition" data-index="${index}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                historyContainer.appendChild(historyItem);
                historyItem.querySelector('.delete-btn').addEventListener('click', () => {
                    showConfirmModal(translations[currentLanguage].delete_item_confirm, () => {
                        state.history.splice(index, 1);
                        updateHistory();
                    });
                });
            });
        }

        function updateStats() {
            const wins = 0;
            const losses = 0;
            const total = wins + losses;
            const winRate = 0;
            const streak = 'N/A';
            const lastFive = state.lastResults.bigsmall.slice(0, 5).join(', ') || '-';

            if (document.getElementById('winRate')) document.getElementById('winRate').textContent = `${winRate}%`;
            if (document.getElementById('totalWinBets')) document.getElementById('totalWinBets').textContent = wins;
            if (document.getElementById('totalLossBets')) document.getElementById('totalLossBets').textContent = losses;
            if (document.getElementById('statsTotalWins')) document.getElementById('statsTotalWins').textContent = wins;
            if (document.getElementById('statsTotalLosses')) document.getElementById('statsTotalLosses').textContent = losses;
            if (document.getElementById('statsWinRate')) document.getElementById('statsWinRate').textContent = `${winRate}%`;
            if (document.getElementById('currentStreak')) document.getElementById('currentStreak').textContent = streak;
            if (document.getElementById('lastFiveResults')) document.getElementById('lastFiveResults').textContent = lastFive;
        }

        async function updateAnalysisDashboard() {
            const data = await fetchOptimizedData();
            const numbers = data.length ? data.map(item => parseInt(item.number, 10) % 10) : [];
            let mostFrequent = '-';
            let leastFrequent = '-';
            if (numbers.length > 0) {
                const freq = numbers.reduce((acc, n) => {
                    acc[n] = (acc[n] || 0) + 1;
                    return acc;
                }, {});
                const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
                mostFrequent = sorted[0]?.[0] || '-';
                leastFrequent = sorted[sorted.length - 1]?.[0] || '-';
            }
            if (document.getElementById('mostFrequent')) document.getElementById('mostFrequent').textContent = mostFrequent;
            if (document.getElementById('leastFrequent')) document.getElementById('leastFrequent').textContent = leastFrequent;
        }

        document.getElementById('deleteAllHistoryBtn').addEventListener('click', () => {
            showConfirmModal(translations[currentLanguage].delete_all_confirm, () => {
                state.history = [];
                state.stats.totalWins = 0;
                state.stats.totalLosses = 0;
                state.stats.winCount = 0;
                state.stats.lossStreak = 0;
                state.stats.totalBets = 0;
                state.lastResults.bigsmall = [];
                updateHistory();
                updateStats();
                if (isSoundEnabled) {
                    new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play();
                }
            });
        });

        let timerRAF;
        // --- UPDATED: Period Timer with IST Calculation ---
        function updatePeriodAndTimer() {
            const now = new Date();
            const currentTime = now.getTime();
            if (currentTime - state.lastTimerUpdate < 1000) {
                timerRAF = requestAnimationFrame(updatePeriodAndTimer);
                return;
            }
            state.lastTimerUpdate = currentTime;

            // Convert current time to Indian Standard Time (UTC+5:30)
            const istOffset = 330 * 60000; // 5.5 hours in milliseconds
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const istTime = new Date(utc + istOffset);

            const year = istTime.getFullYear();
            const month = String(istTime.getMonth() + 1).padStart(2, '0');
            const day = String(istTime.getDate()).padStart(2, '0');
            
            // The game seems to have 1440 periods per day (one per minute)
            const totalMinutesToday = istTime.getHours() * 60 + istTime.getMinutes();
            const periodIndex = totalMinutesToday + 1; // 1-based index for the day
            
            // Construct the period number string
            const periodNumber = `${year}${month}${day}${String(periodIndex).padStart(4, '0')}`;

            if (state.lastPeriodNumber !== periodNumber) {
                state.lastPeriodNumber = periodNumber;
                state.currentPrediction = null;
                state.currentPeriod = periodNumber;
                generateResult(periodNumber); 
            }

            if (document.getElementById('currentPeriod')) {
                document.getElementById('currentPeriod').textContent = periodNumber.slice(-5);
            }

            timerRAF = requestAnimationFrame(updatePeriodAndTimer);
        }

        if (isNotificationsEnabled && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        function initializeApp() {
            updateLanguage(); 
            updateServerStatus(true);
            updatePeriodAndTimer(); 
            updateStats();
            updateAnalysisDashboard();
        }

        window.addEventListener('beforeunload', () => {
            if (timerRAF) cancelAnimationFrame(timerRAF);
        });
    </script>
</body>
</html>
